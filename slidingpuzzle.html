<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd"
    >
<html lang="en">
<head>
    <style>
        table {
            border-collapse: collapse;
        }
        table, tr, td {
            border: 1px solid black;
            padding: 0px;
            margin: 0px;
        }
    </style>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.js"></script>
    <script type="text/javascript">
        // Admittedly, this is kind of poorly coded style-wise but it gets the job done for now.
        // I'd like to rewrite this code to wrap it into a SlidingPuzzle class that can be generalized
        // to MxN size grids, and get this off into another file with minimal knowledge needed by the
        // user to instantiate one of these in the $(document).ready() callback. - 1/25 10:40pm
        var adjacenciesList = {'box1': ['box2', 'box5'],
                                'box2': ['box1', 'box3', 'box6'],
                                'box3': ['box2', 'box4', 'box7'],
                                'box4': ['box3', 'box8'],
                                'box5': ['box1', 'box6', 'box9'],
                                'box6': ['box2', 'box5', 'box7', 'box10'],
                                'box7': ['box3', 'box6', 'box8', 'box11'],
                                'box8': ['box4', 'box7', 'box12'],
                                'box9': ['box5', 'box10', 'box13'],
                                'box10': ['box6', 'box9', 'box11', 'box14'],
                                'box11': ['box7', 'box10', 'box12', 'box15'],
                                'box12': ['box8', 'box11', 'box16'],
                                'box13': ['box9', 'box14'],
                                'box14': ['box10', 'box13', 'box15'],
                                'box15': ['box11', 'box14', 'box16'],
                                'box16': ['box12', 'box15']};
        var blankSpace = '<img src="http://www.tothebe.at/projects/sternthal/puzzle/images/blank_space.png" width="150" height="150" />';
        var validStartBoard = { 'box1':'<img src="http://www.tothebe.at/projects/sternthal/puzzle/images/box1.png" width="150" height="150" />',
                                'box2':'<img src="http://www.tothebe.at/projects/sternthal/puzzle/images/box2.png" width="150" height="150" />',
                                'box3':'<img src="http://www.tothebe.at/projects/sternthal/puzzle/images/box3.png" width="150" height="150" />',
                                'box4':'<img src="http://www.tothebe.at/projects/sternthal/puzzle/images/box4.png" width="150" height="150" />',
                                'box5':'<img src="http://www.tothebe.at/projects/sternthal/puzzle/images/box5.png" width="150" height="150" />',
                                'box6':'<img src="http://www.tothebe.at/projects/sternthal/puzzle/images/box6.png" width="150" height="150" />',
                                'box7':'<img src="http://www.tothebe.at/projects/sternthal/puzzle/images/box7.png" width="150" height="150" />',
                                'box8':'<img src="http://www.tothebe.at/projects/sternthal/puzzle/images/box8.png" width="150" height="150" />',
                                'box9':'<img src="http://www.tothebe.at/projects/sternthal/puzzle/images/box9.png" width="150" height="150" />',
                                'box10':'<img src="http://www.tothebe.at/projects/sternthal/puzzle/images/box10.png" width="150" height="150" />',
                                'box11':'<img src="http://www.tothebe.at/projects/sternthal/puzzle/images/box11.png" width="150" height="150" />',
                                'box12':'<img src="http://www.tothebe.at/projects/sternthal/puzzle/images/box12.png" width="150" height="150" />',
                                'box13':'<img src="http://www.tothebe.at/projects/sternthal/puzzle/images/box13.png" width="150" height="150" />',
                                'box14':'<img src="http://www.tothebe.at/projects/sternthal/puzzle/images/box14.png" width="150" height="150" />',
                                'box15':'<img src="http://www.tothebe.at/projects/sternthal/puzzle/images/box15.png" width="150" height="150" />',
                                'box16':blankSpace};
        var invalidStartBoard = {   'box1':'<img src="http://www.tothebe.at/projects/sternthal/puzzle/images/box1.png" width="150" height="150" />',
                                    'box2':'<img src="http://www.tothebe.at/projects/sternthal/puzzle/images/box2.png" width="150" height="150" />',
                                    'box3':'<img src="http://www.tothebe.at/projects/sternthal/puzzle/images/box3.png" width="150" height="150" />',
                                    'box4':'<img src="http://www.tothebe.at/projects/sternthal/puzzle/images/box4.png" width="150" height="150" />',
                                    'box5':'<img src="http://www.tothebe.at/projects/sternthal/puzzle/images/box5.png" width="150" height="150" />',
                                    'box6':'<img src="http://www.tothebe.at/projects/sternthal/puzzle/images/box6.png" width="150" height="150" />',
                                    'box7':'<img src="http://www.tothebe.at/projects/sternthal/puzzle/images/box7.png" width="150" height="150" />',
                                    'box8':'<img src="http://www.tothebe.at/projects/sternthal/puzzle/images/box8.png" width="150" height="150" />',
                                    'box9':'<img src="http://www.tothebe.at/projects/sternthal/puzzle/images/box9.png" width="150" height="150" />',
                                    'box10':'<img src="http://www.tothebe.at/projects/sternthal/puzzle/images/box10.png" width="150" height="150" />',
                                    'box11':'<img src="http://www.tothebe.at/projects/sternthal/puzzle/images/box11.png" width="150" height="150" />',
                                    'box12':'<img src="http://www.tothebe.at/projects/sternthal/puzzle/images/box12.png" width="150" height="150" />',
                                    'box13':'<img src="http://www.tothebe.at/projects/sternthal/puzzle/images/box13.png" width="150" height="150" />',
                                    'box14':'<img src="http://www.tothebe.at/projects/sternthal/puzzle/images/box15.png" width="150" height="150" />',
                                    'box15':'<img src="http://www.tothebe.at/projects/sternthal/puzzle/images/box14.png" width="150" height="150" />',
                                    'box16':blankSpace};
        var moves = new Array();

        function Move(box1, box2) {
            moves.push([box1, box2]);
        }
        
	/*
        function isValidMove(box1, box2) {
            // Check that one of them is the blank space
            if((box1!=blankSpace) && (box2!=blankSpace)) {
                return false;
            }
            // Check that they are adjacent
            if(box1 in adjacenciesList[box2]) {
                return true;
            }
            return false;
        }
	*/
        function hasWon() {
            var currentState = ApplyMoves(validStartBoard, moves);
            for(var i in currentState) {
                if(currentState[i] != validStartBoard[i]) {
                    return false;
                }
            }
            return true;
        }
		
        function ClickBox(boxClicked) {
            var currentState = ApplyMoves(validStartBoard, moves);
            var blankBox;
            for(var i in currentState) {
                if(currentState[i] == blankSpace) {
                    blankBox = i;
                    break;
                }
            }
            // Is the blank box in the list of adjacent boxes?
            var adjacentBoxes = adjacenciesList[boxClicked];
            var blankIsAdjacent = false;
            for(var i in adjacentBoxes) {
                if(blankBox==adjacentBoxes[i]) {
                    blankIsAdjacent = true;
                    break;
                }
            }
            if(blankIsAdjacent) {
                Move(boxClicked, blankBox);
                // Display the new board
                DisplayPuzzle(ApplyMoves(validStartBoard, moves));
                // Check if we've won
                if(hasWon()) {
                    jQuery('#win').html("<h2>You won!</h2>"); 
                }
                
            }
        }

		// We may want to handle different sets of moves for custom puzzles
		// As well as different base configurations for legal/illegal games
        function ApplyMoves(basePuzzleState, movesList) {
            // Make a copy of the base values
            var currentState = {};
            for(var i in basePuzzleState) {
                    currentState[i] = basePuzzleState[i];
            }
            // Apply the moves to the copy
            for(var i in movesList) {
                    var move = movesList[i];
                    var temp = currentState[move[0]];
                    currentState[move[0]] = currentState[move[1]];
                    currentState[move[1]] = temp;
            }
            // Return the copy
	    return currentState;
        }

        function DisplayPuzzle(puzzleState) {
            // Fill in the inner html of each table cell with the corresponding puzzle state cell
            for(var box in puzzleState) {
                jQuery('#' + box).html(puzzleState[box]);
            }
        }

        
        jQuery(document).ready(function() {
            DisplayPuzzle(ApplyMoves(validStartBoard, moves));
            jQuery('td').click(function() {
                var boxClicked = jQuery(this).attr('id');
                ClickBox(boxClicked);
            });
        });
    </script>    
    <title></title>
</head>
<body>
    <div>
        <table>
            <tr><td id="box1"></td><td id="box2"></td><td id="box3"></td><td id="box4"></td></tr>
            <tr><td id="box5"></td><td id="box6"></td><td id="box7"></td><td id="box8"></td></tr>
            <tr><td id="box9"></td><td id="box10"></td><td id="box11"></td><td id="box12"></td></tr>
            <tr><td id="box13"></td><td id="box14"></td><td id="box15"></td><td id="box16"></td></tr>
        </table>        
    </div>
    <div id="win"></div>
</body>
</html>
